# bats file_tags=md5,file,openssl

@test "md5 65B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl md5 -q 65B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl md5 65B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "md5 56B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl md5 -q 56B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl md5 56B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "md5 64B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl md5 -q 64B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl md5 64B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "md5 50MB" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl md5 -q 50MB
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl md5 50MB | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "md5 128B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl md5 -q 128B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl md5 128B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "md5 63B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl md5 -q 63B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl md5 63B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "md5 100B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl md5 -q 100B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl md5 100B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "md5 1B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl md5 -q 1B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl md5 1B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "md5 57B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl md5 -q 57B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl md5 57B | awk '{print $2}')
    rm -f "$valgrind_log"
}

# bats file_tags=md5,stdin,openssl

@test "md5 < 65B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl md5 -q < 65B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl md5 < 65B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "md5 < 56B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl md5 -q < 56B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl md5 < 56B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "md5 < 64B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl md5 -q < 64B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl md5 < 64B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "md5 < 50MB" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl md5 -q < 50MB
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl md5 < 50MB | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "md5 < 128B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl md5 -q < 128B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl md5 < 128B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "md5 < 63B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl md5 -q < 63B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl md5 < 63B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "md5 < 100B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl md5 -q < 100B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl md5 < 100B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "md5 < 1B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl md5 -q < 1B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl md5 < 1B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "md5 < 57B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl md5 -q < 57B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl md5 < 57B | awk '{print $2}')
    rm -f "$valgrind_log"
}
# bats file_tags=blake2s,file,openssl

@test "blake2s 65B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl blake2s -q 65B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl blake2s256 65B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "blake2s 56B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl blake2s -q 56B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl blake2s256 56B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "blake2s 64B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl blake2s -q 64B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl blake2s256 64B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "blake2s 50MB" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl blake2s -q 50MB
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl blake2s256 50MB | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "blake2s 128B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl blake2s -q 128B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl blake2s256 128B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "blake2s 63B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl blake2s -q 63B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl blake2s256 63B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "blake2s 100B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl blake2s -q 100B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl blake2s256 100B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "blake2s 1B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl blake2s -q 1B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl blake2s256 1B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "blake2s 57B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl blake2s -q 57B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl blake2s256 57B | awk '{print $2}')
    rm -f "$valgrind_log"
}

# bats file_tags=blake2s,stdin,openssl

@test "blake2s < 65B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl blake2s -q < 65B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl blake2s256 < 65B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "blake2s < 56B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl blake2s -q < 56B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl blake2s256 < 56B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "blake2s < 64B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl blake2s -q < 64B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl blake2s256 < 64B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "blake2s < 50MB" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl blake2s -q < 50MB
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl blake2s256 < 50MB | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "blake2s < 128B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl blake2s -q < 128B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl blake2s256 < 128B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "blake2s < 63B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl blake2s -q < 63B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl blake2s256 < 63B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "blake2s < 100B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl blake2s -q < 100B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl blake2s256 < 100B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "blake2s < 1B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl blake2s -q < 1B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl blake2s256 < 1B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "blake2s < 57B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl blake2s -q < 57B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl blake2s256 < 57B | awk '{print $2}')
    rm -f "$valgrind_log"
}
# bats file_tags=sha256,file,openssl

@test "sha256 65B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl sha256 -q 65B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl sha256 65B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "sha256 56B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl sha256 -q 56B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl sha256 56B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "sha256 64B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl sha256 -q 64B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl sha256 64B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "sha256 50MB" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl sha256 -q 50MB
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl sha256 50MB | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "sha256 128B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl sha256 -q 128B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl sha256 128B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "sha256 63B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl sha256 -q 63B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl sha256 63B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "sha256 100B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl sha256 -q 100B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl sha256 100B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "sha256 1B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl sha256 -q 1B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl sha256 1B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "sha256 57B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl sha256 -q 57B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl sha256 57B | awk '{print $2}')
    rm -f "$valgrind_log"
}

# bats file_tags=sha256,stdin,openssl

@test "sha256 < 65B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl sha256 -q < 65B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl sha256 < 65B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "sha256 < 56B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl sha256 -q < 56B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl sha256 < 56B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "sha256 < 64B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl sha256 -q < 64B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl sha256 < 64B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "sha256 < 50MB" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl sha256 -q < 50MB
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl sha256 < 50MB | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "sha256 < 128B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl sha256 -q < 128B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl sha256 < 128B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "sha256 < 63B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl sha256 -q < 63B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl sha256 < 63B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "sha256 < 100B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl sha256 -q < 100B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl sha256 < 100B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "sha256 < 1B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl sha256 -q < 1B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl sha256 < 1B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "sha256 < 57B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl sha256 -q < 57B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl sha256 < 57B | awk '{print $2}')
    rm -f "$valgrind_log"
}
# bats file_tags=blake2b,file,openssl

@test "blake2b 65B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl blake2b -q 65B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl blake2b512 65B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "blake2b 56B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl blake2b -q 56B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl blake2b512 56B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "blake2b 64B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl blake2b -q 64B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl blake2b512 64B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "blake2b 50MB" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl blake2b -q 50MB
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl blake2b512 50MB | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "blake2b 128B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl blake2b -q 128B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl blake2b512 128B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "blake2b 63B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl blake2b -q 63B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl blake2b512 63B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "blake2b 100B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl blake2b -q 100B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl blake2b512 100B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "blake2b 1B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl blake2b -q 1B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl blake2b512 1B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "blake2b 57B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl blake2b -q 57B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl blake2b512 57B | awk '{print $2}')
    rm -f "$valgrind_log"
}

# bats file_tags=blake2b,stdin,openssl

@test "blake2b < 65B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl blake2b -q < 65B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl blake2b512 < 65B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "blake2b < 56B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl blake2b -q < 56B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl blake2b512 < 56B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "blake2b < 64B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl blake2b -q < 64B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl blake2b512 < 64B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "blake2b < 50MB" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl blake2b -q < 50MB
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl blake2b512 < 50MB | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "blake2b < 128B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl blake2b -q < 128B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl blake2b512 < 128B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "blake2b < 63B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl blake2b -q < 63B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl blake2b512 < 63B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "blake2b < 100B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl blake2b -q < 100B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl blake2b512 < 100B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "blake2b < 1B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl blake2b -q < 1B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl blake2b512 < 1B | awk '{print $2}')
    rm -f "$valgrind_log"
}

@test "blake2b < 57B" {
    local valgrind_log=$(mktemp)
    run valgrind --log-file="$valgrind_log" ./ft_ssl blake2b -q < 57B
    grep -q "All heap blocks were freed -- no leaks are possible" "$valgrind_log"
    assert_success
    grep -q "ERROR SUMMARY: 0 errors from 0 contexts" "$valgrind_log"
    assert_success
    assert_output $(openssl blake2b512 < 57B | awk '{print $2}')
    rm -f "$valgrind_log"
}
